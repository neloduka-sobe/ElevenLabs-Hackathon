{
  "name": "User Interaction Agent",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "Hi there! ðŸ‘‹\nI am here to help you change the world using data! Do you have a specific need or problem you come to me today with?",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -140,
        -60
      ],
      "id": "82e07243-9f5b-4ae2-99e2-86f50e82b51e",
      "name": "When chat message received",
      "webhookId": "76e0b580-dd24-47cb-87a7-424705b0f917"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.retrieverWorkflow",
      "typeVersion": 1.1,
      "position": [
        60,
        360
      ],
      "id": "9a627f6c-e0a8-45c4-9459-02bb60127659",
      "name": "Workflow Retriever"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are an intelligent agent integrated into an n8n workflow with access to a MongoDB database via a built-in tool. Your primary responsibilities are to classify user intent, generate query parameters for MongoDB, execute the query using the tool, and return the results to the user. Follow these steps to fulfill your role:\n\n1. **Classify User Intent:**\n   - Analyze the user's input to determine if it is a specific request (e.g., \"I need a dataset for e-commerce transactions\") or a general problem (e.g., \"I want to analyze customer behavior\").\n   - Identify the key entities, filters, or criteria mentioned by the user (e.g., dataset type, time range, specific fields).\n\n2. **Generate Query Parameters:**\n   - Based on the classified intent, dynamically construct the necessary parameters for a MongoDB query, such as filters, projections, or aggregations.\n   - Ensure the parameters are optimized and aligned with the user's request.\n\n3. **Execute MongoDB Query:**\n   - Use the built-in MongoDB tool in n8n to execute the query with the generated parameters.\n   - Fetch the datasets that match the query criteria.\n\n4. **Return Results:**\n   - Format the fetched datasets into a user-friendly response.\n   - Send the results back to the user via the Chat Node.\n\n**Guidelines for the Agent:**\n- Always prioritize accuracy when classifying user intent and generating query parameters.\n- Ensure the query parameters are valid and efficient.\n- Handle errors gracefully (e.g., if the query returns no results, inform the user and suggest alternative actions).\n- Keep the response concise and relevant to the user's request.\n- Do not write or return MongoDB code; instead, rely on the integrated MongoDB tool to execute queries."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        60,
        -60
      ],
      "id": "ac580cfc-a132-4cc1-8f14-47321b3758c6",
      "name": "AI Agent",
      "alwaysOutputData": false,
      "notesInFlow": false
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-pro-latest",
        "options": {
          "maxOutputTokens": 2048
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        60,
        180
      ],
      "id": "75ae5757-3580-4000-891d-e16bf806fb48",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "eRmx5P6UaMQE3NKq",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "collection": "main",
        "options": {},
        "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query__JSON_Format_', `You are an intelligent assistant that helps users find datasets in a MongoDB database. Your task is to generate a valid MongoDB query based on the user's request. The MongoDB collection is named \"main\" and has the following structure (example data provided):\n\n\\`\\`\\`json\n{\n  \"_id\": ObjectId(\"auto-generated-by-mongodb\"),\n  \"dataset_id\": \"unique-dataset-identifier\",\n  \"metadata\": {\n    \"title\": \"Sample Dataset Title\",\n    \"description\": \"This dataset contains information about...\",\n    \"domain\": \"e-commerce\",\n    \"source\": \"Kaggle\",\n    \"license\": {\n      \"type\": \"CC BY 4.0\",\n      \"restrictions\": \"Non-commercial use only\",\n      \"acquisition_process\": \"Contact provider at license@example.com\",\n      \"deep_web\": false\n    },\n    \"creation_date\": \"2023-10-01\",\n    \"update_frequency\": \"monthly\",\n    \"version\": \"1.2.0\",\n    \"provenance\": {\n      \"creator\": \"John Doe\",\n      \"transformations\": \"Cleaned and normalized\",\n      \"lineage\": \"Derived from dataset XYZ\"\n    }\n  },\n  \"structural_info\": {\n    \"schema\": [\n      {\n        \"column_name\": \"user_id\",\n        \"data_type\": \"integer\",\n        \"description\": \"Unique identifier for users\"\n      },\n      {\n        \"column_name\": \"purchase_amount\",\n        \"data_type\": \"float\",\n        \"description\": \"Amount spent in USD\"\n      }\n    ],\n    \"size\": {\n      \"rows\": 100000,\n      \"columns\": 10,\n      \"file_size\": \"250MB\"\n    },\n    \"format\": \"CSV\",\n    \"hierarchy\": \"flat\"\n  },\n  \"temporal_info\": {\n    \"time_range\": {\n      \"start\": \"2020-01-01\",\n      \"end\": \"2023-01-01\"\n    },\n    \"geographic_coverage\": \"Global\"\n  },\n  \"quality_indicators\": {\n    \"completeness\": 0.95,\n    \"accuracy\": \"high\",\n    \"consistency\": \"consistent\",\n    \"outliers\": \"present\",\n    \"bias\": \"low\",\n    \"cleaning_requirements\": [\n      {\n        \"column\": \"age\",\n        \"issue\": \"missing_values\",\n        \"action\": \"impute_with_mean\"\n      },\n      {\n        \"column\": \"purchase_amount\",\n        \"issue\": \"outliers\",\n        \"action\": \"remove_outliers\"\n      }\n    ]\n  },\n  \"usage_info\": {\n    \"usage_statistics\": {\n      \"downloads\": 1500,\n      \"last_accessed\": \"2023-10-15\"\n    },\n    \"citations\": [\n      {\n        \"paper_title\": \"A Study on E-Commerce Trends\",\n        \"author\": \"Jane Smith\",\n        \"year\": 2022\n      }\n    ],\n    \"user_ratings\": {\n      \"average_rating\": 4.5,\n      \"total_ratings\": 120\n    }\n  },\n  \"ai_ml_relevance\": {\n    \"suitable_tasks\": [\"classification\", \"regression\"],\n    \"features\": [\"user_id\", \"purchase_amount\"],\n    \"labels\": [\"churn\"],\n    \"related_datasets\": [\"dataset-xyz\", \"dataset-abc\"]\n  },\n  \"preview\": {\n    \"sample_data\": [\n      {\n        \"user_id\": 1,\n        \"purchase_amount\": 50.0\n      },\n      {\n        \"user_id\": 2,\n        \"purchase_amount\": 120.0\n      }\n    ],\n    \"summary_statistics\": {\n      \"user_id\": {\n        \"type\": \"integer\",\n        \"min\": 1,\n        \"max\": 100000,\n        \"missing_values\": 0\n      },\n      \"purchase_amount\": {\n        \"type\": \"float\",\n        \"mean\": 75.0,\n        \"std_dev\": 25.0,\n        \"missing_values\": 5\n      }\n    }\n  },\n  \"download_info\": {\n    \"access_method\": \"API\",\n    \"download_url\": \"https://example.com/dataset/download\",\n    \"authentication_required\": true,\n    \"authentication_details\": {\n      \"api_key\": \"your-api-key\",\n      \"endpoint\": \"https://example.com/api/v1/dataset\"\n    },\n    \"file_format\": \"CSV\",\n    \"file_size\": \"250MB\",\n    \"instructions\": \"Use the provided API key to download the dataset via the endpoint.\"\n  }\n}\n\\`\\`\\`\n\nInstructions:\n\n    Analyze the user's request.\n\n    Identify relevant fields and conditions for the MongoDB query.\n\n    Generate a valid MongoDB query in JSON format.\n\nYour Task:\n\nGenerate a MongoDB query based on the user's request.\n\nThis version is shorter but still contains all the necessary details for the task.`, 'json') }}"
      },
      "type": "n8n-nodes-base.mongoDbTool",
      "typeVersion": 1.1,
      "position": [
        320,
        180
      ],
      "id": "3cdef614-0fa9-4fb2-ad54-ed0c112024df",
      "name": "MongoDB",
      "credentials": {
        "mongoDb": {
          "id": "4ZCGKEyGFEU9kAgy",
          "name": "MongoDB"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        160,
        180
      ],
      "id": "23dd19e5-a89d-4408-a77f-97ec351efefe",
      "name": "Window Buffer Memory"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Retriever": {
      "ai_retriever": [
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MongoDB": {
      "ai_tool": [
        []
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d08d3eab-e5b3-4145-9514-6046f7935a93",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c5ae296890d47f5efa8bbbb6a43c2f0959c8b12564819d2a45be51e28a0d178c"
  },
  "id": "PK3V0qF8xEPubmA3",
  "tags": []
}